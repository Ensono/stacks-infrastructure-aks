parameters:
  EirctlVersion: 0.9.9

steps:
  # Checkout self repo
  - checkout: self

  # Install eirctl task automation tool
  - task: Bash@3
    displayName: "Install: eirctl"
    inputs:
      targetType: inline
      script: |
        set -euo pipefail
        EIRCTL_URL="https://github.com/Ensono/eirctl/releases/download/${{ parameters.EirctlVersion }}/eirctl-linux-amd64"
        EIRCTL_PATH="/usr/local/bin/eirctl"
        echo "Downloading eirctl ${{ parameters.EirctlVersion }} from ${EIRCTL_URL}..."
        if ! sudo wget --timeout=30 --tries=3 -q "${EIRCTL_URL}" -O "${EIRCTL_PATH}"; then
          echo "##[error]Failed to download eirctl from ${EIRCTL_URL}"
          exit 1
        fi
        sudo chmod +x "${EIRCTL_PATH}"
        if ! eirctl --version; then
          echo "##[error]eirctl installation verification failed"
          exit 1
        fi
        echo "eirctl installed successfully"
